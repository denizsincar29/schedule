# Schedule 1.0.0-beta3
Программа для просмотра расписания занятий в САФУ.
Позволяет просматривать расписание студентов и преподавателей САФУ.
Программа написана на языке программирования Python с использованием библиотеки [WxPython](https://wxpython.org/) и [httpx](https://www.python-httpx.org/).
Имеется возможность просмотра расписание на выбранный день, а так же на диапазон дат. Есть возможность просмотра расписания других людей, а так же пересечения своего расписания с другими людьми (только в консольном клиенте). Есть возможность сохранять текстовый файл с расписанием.
# Цель работы
Создать простую, удобную и доступную для незрячих программу для просмотра расписания занятий в САФУ.
# Задачи
1. (x) Разработать модуль на Python для работы с API [Modeus](https://narfu.modeus.org) и парсер ответа API в удобный для программы формат.
2. (x) разработать простой и интуитивно понятный консольный клиент со всеми необходимыми функциями программы. Консольный клиент должен быть доступен для использования людей, не опытных в работе с командной строкой.
3. (x) разработать графический интерфейс для программы. Доступность для незрячих в приоритете.
4. ( ) Сделать программу самодостаточной и автообновляемой (Бета). Программа должна сама обновляться до последней версии при запуске.

# Аналоги
1. [Modeus](https://narfu.modeus.org) - официальный сайт расписания САФУ.
    - Преимущества:
        - более расширенный функционал
        - возможность сохранения расписания ввиде календаря в формате iCal
    - Недостатки:
        - неудобный интерфейс. После каждой сессии требуется вводить данные заново.
        - Плохая доступность для незрячих. Интерфейс выполнен в виде таблицы, что затрудняет использование сайта с программами для чтения с экрана.
        - {todo}
2. [Официальный сайт расписания САФУ](https://ruz.narfu.ru)
    сайт устарел и почти перестал использоваться. При попытке входа на сайт открывается страница с ошибкой 504 Gateway Time-out.
3. Telegram и ВК бот [Arctic guide](https://t.me/ArcticGuide_bot)
    - Преимущества:
        - удобный интерфейс
        - возможность просмотра расписания других людей
        - возможность просмотра расписания сессии
        - Можно открыть справочник по СТО.
        - можно подписаться на уведомления о расписании на каждый день
    - Недостатки:
        - нельзя ввести дату вручную. Выбор даты происходит с помощью кнопок.
    Бот Arctic guide является отличным дополнением к моей программе.
# Структура программы
Программа использует API [Modeus](https://narfu.modeus.org) для получения данных о расписании.
Код программы разделен на модули:
1. [modeus.py](../modeus.py) - модуль для работы с API Modeus.
Использует библиотеку httpx для отправки запросов на сервер.
Содержит несколько функций для работы с API:
    - modeus_parse_token(username, password):
        принимает логин и пароль от Модеуса и возвращает токен, который живёт всего 12 часов. С помощью него осуществляется доступ к API.
    - modeus_auth(username, password):
        Функция для быстрой проверки на правильность логина и пароля. При успешной авторизации возвращает True, иначе False. Часть функции modeus_parse_token.
    - get_schedule(person_id, token, start_time, end_time):
        Функция для получения расписания. Принимает id человека, токен, начальное и конечное время. Возвращает расписание в виде большого словаря, полученного из API.
        - а так же функция для поиска человека по ФИО или по id и функция получения списка студентов и преподавателей для конкретного события.
2. [schedule.py](../schedule.py) - модуль с классом Schedule. Класс содержит очень много методов для удобной работы с расписанием. 
Возможности:
    - кешировать токен и проверять его срок
    - кешировать расписание на месяц и проверять изменения в расписании путём сравнения данных
    - кешировать данные о людях
    - искать людей по ФИО или по ID и сохранять свой профиль, чтобы не переключаться на свой профиль после просмотра чужого расписания
    - получать текстовую форму расписания, списка людей, изменений в расписании
    - и много других helper-методов.
3. [schedparser.py](../schedparser.py) - модуль для парсинга json-ответов API в удобный для программы короткий JSON, а так же для перевода данных в текстовый формат.
4. [main.py](../main.py) - консольный клиент программы.
5. [main.pyw](../main.pyw) - графический клиент. Это само окно и интерфейс программы.
6. [app_logic.py](../app_logic.py) - модуль, содержащий логику работы графической программы. Содержит класс App(Thread), который работает в отдельном потоке и содержит всю логику работы программы. Именно этот класс работает с модулем schedule.py. Главный файл программы передаёт ему команды и получает ответы.
7. [autoupdate/update.py](../autoupdate/update.py) - модуль для автообновления программы. Пока не реализован в программе, но модуль работает.
8. [autoupdate/sfx.py](../autoupdate/sfx.py) - модуль для создания самораспаковывающегося архива.
Программа выполнена в виде Git репозитория и имеет файлы readme.md, .gitignore и requirements.txt.
